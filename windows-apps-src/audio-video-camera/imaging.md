---
author: laurenhughes
ms.assetid: 3FD2AA71-EF67-47B2-9332-3FFA5D3703EA
description: This article explains how to load and save image files using BitmapDecoder and BitmapEncoder and how to use the SoftwareBitmap object to represent bitmap images.
title: Create, edit, and save bitmap images
ms.author: lahugh
ms.date: 03/22/2018
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: windows 10, uwp
ms.localizationpriority: medium
---

# Create, edit, and save bitmap images



This article explains how to load and save image files using [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) and [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206) and how to use the [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887358) object to represent bitmap images.

The **SoftwareBitmap** class is a versatile API that can be created from multiple sources including image files, [**WriteableBitmap**](https://msdn.microsoft.com/library/windows/apps/br243259) objects, Direct3D surfaces, and code. **SoftwareBitmap** allows you to easily convert between different pixel formats and alpha modes, and allows low-level access to pixel data. Also, **SoftwareBitmap** is a common interface used by multiple features of Windows, including:

-   [**CapturedFrame**](https://msdn.microsoft.com/library/windows/apps/dn278725) allows you to get frames captured by the camera as a **SoftwareBitmap**.

-   [**VideoFrame**](https://msdn.microsoft.com/library/windows/apps/dn930917) allows you to get a **SoftwareBitmap** representation of a **VideoFrame**.

-   [**FaceDetector**](https://msdn.microsoft.com/library/windows/apps/dn974129) allows you to detect faces in a **SoftwareBitmap**.

The sample code in this article uses APIs from the following namespaces.

[!code-cs[Namespaces](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetNamespaces)]

## Create a SoftwareBitmap from an image file with BitmapDecoder

To create a [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887358) from a file, get an instance of [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) containing the image data. This example uses a [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847) to allow the user to select an image file.

[!code-cs[PickInputFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetPickInputFile)]

Call the [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/br227116) method of the **StorageFile** object to get a random access stream containing the image data. Call the static method [**BitmapDecoder.CreateAsync**](https://msdn.microsoft.com/library/windows/apps/br226182) to get an instance of the [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) class for the specified stream. Call [**GetSoftwareBitmapAsync**](https://msdn.microsoft.com/library/windows/apps/dn887332) to get a [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887358) object containing the image.

[!code-cs[CreateSoftwareBitmapFromFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCreateSoftwareBitmapFromFile)]

## Save a SoftwareBitmap to a file with BitmapEncoder

To save a **SoftwareBitmap** to a file, get an instance of **StorageFile** to which the image will be saved. This example uses a [**FileSavePicker**](https://msdn.microsoft.com/library/windows/apps/br207871) to allow the user to select an output file.

[!code-cs[PickOuputFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetPickOuputFile)]

Call the [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/br227116) method of the **StorageFile** object to get a random access stream to which the image will be written. Call the static method [**BitmapEncoder.CreateAsync**](https://msdn.microsoft.com/library/windows/apps/br226211) to get an instance of the [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206) class for the specified stream. The first parameter to **CreateAsync** is a GUID representing the codec that should be used to encode the image. **BitmapEncoder** class exposes a property containing the ID for each codec supported by the encoder, such as [**JpegEncoderId**](https://msdn.microsoft.com/library/windows/apps/br226226).

Use the [**SetSoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/dn887337) method to set the image that will be encoded. You can set values of the [**BitmapTransform**](https://msdn.microsoft.com/library/windows/apps/br226254) property to apply basic transforms to the image while it is being encoded. The [**IsThumbnailGenerated**](https://msdn.microsoft.com/library/windows/apps/br226225) property determines whether a thumbnail is generated by the encoder. Note that not all file formats support thumbnails, so if you use this feature, you should catch the unsupported operation error that will be thrown if thumbnails are not supported.

Call [**FlushAsync**](https://msdn.microsoft.com/library/windows/apps/br226216) to cause the encoder to write the image data to the specified file.

[!code-cs[SaveSoftwareBitmapToFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetSaveSoftwareBitmapToFile)]

You can specify additional encoding options when you create the **BitmapEncoder** by creating a new [**BitmapPropertySet**](https://msdn.microsoft.com/library/windows/apps/hh974338) object and populating it with one or more [**BitmapTypedValue**](https://msdn.microsoft.com/library/windows/apps/hh700687) objects representing the encoder settings. For a list of supported encoder options, see [BitmapEncoder options reference](bitmapencoder-options-reference.md).

[!code-cs[UseEncodingOptions](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetUseEncodingOptions)]

## Use SoftwareBitmap with a XAML Image control

To display an image within a XAML page using the [**Image**](https://msdn.microsoft.com/library/windows/apps/br242752) control, first define an **Image** control in your XAML page.

[!code-xml[ImageControl](./code/ImagingWin10/cs/MainPage.xaml#SnippetImageControl)]

Currently, the **Image** control only supports images that use BGRA8 encoding and pre-multiplied or no alpha channel. Before attempting to display an image, test to make sure it has the correct format, and if not, use the **SoftwareBitmap** static [**Convert**](https://msdn.microsoft.com/library/windows/apps/dn887362) method to convert the image to the supported format.

Create a new [**SoftwareBitmapSource**](https://msdn.microsoft.com/library/windows/apps/dn997854) object. Set the contents of the source object by calling [**SetBitmapAsync**](https://msdn.microsoft.com/library/windows/apps/dn997856), passing in a **SoftwareBitmap**. Then you can set the [**Source**](https://msdn.microsoft.com/library/windows/apps/br242760) property of the **Image** control to the newly created **SoftwareBitmapSource**.

[!code-cs[SoftwareBitmapToWriteableBitmap](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetSoftwareBitmapToWriteableBitmap)]

You can also use **SoftwareBitmapSource** to set a **SoftwareBitmap** as the [**ImageSource**](https://msdn.microsoft.com/library/windows/apps/br210105) for an [**ImageBrush**](https://msdn.microsoft.com/library/windows/apps/br210101).

## Create a SoftwareBitmap from a WriteableBitmap

You can create a **SoftwareBitmap** from an existing **WriteableBitmap** by calling [**SoftwareBitmap.CreateCopyFromBuffer**](https://msdn.microsoft.com/library/windows/apps/dn887370) and supplying the **PixelBuffer** property of the **WriteableBitmap** to set the pixel data. The second argument allows you to request a pixel format for the newly created **WriteableBitmap**. You can use the [**PixelWidth**](https://msdn.microsoft.com/library/windows/apps/br243253) and [**PixelHeight**](https://msdn.microsoft.com/library/windows/apps/br243251) properties of the **WriteableBitmap** to specify the dimensions of the new image.

[!code-cs[WriteableBitmapToSoftwareBitmap](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetWriteableBitmapToSoftwareBitmap)]

## Create or edit a SoftwareBitmap programmatically

So far this topic has addressed working with image files. You can also create a new **SoftwareBitmap** programatically in code and use the same technique to access and modify the **SoftwareBitmap**'s pixel data.

**SoftwareBitmap** uses COM interop to expose the raw buffer containing the pixel data.

To use COM interop, you must include a reference to the **System.Runtime.InteropServices** namespace in your project.

[!code-cs[InteropNamespace](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetInteropNamespace)]

Initialize the [**IMemoryBufferByteAccess**](https://msdn.microsoft.com/library/windows/desktop/mt297505) COM interface by adding the following code within your namespace.

[!code-cs[COMImport](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCOMImport)]

Create a new **SoftwareBitmap** with pixel format and size you want. Or, use an existing **SoftwareBitmap** for which you want to edit the pixel data. Call [**SoftwareBitmap.LockBuffer**](https://msdn.microsoft.com/library/windows/apps/dn887380) to obtain an instance of the [**BitmapBuffer**](https://msdn.microsoft.com/library/windows/apps/dn887325) class representing the pixel data buffer. Cast the **BitmapBuffer** to the **IMemoryBufferByteAccess** COM interface and then call [**IMemoryBufferByteAccess.GetBuffer**](https://msdn.microsoft.com/library/windows/desktop/mt297506) to populate a byte array with data. Use the [**BitmapBuffer.GetPlaneDescription**](https://msdn.microsoft.com/library/windows/apps/dn887330) method to get a [**BitmapPlaneDescription**](https://msdn.microsoft.com/library/windows/apps/dn887342) object that will help you calculate the offset into the buffer for each pixel.

[!code-cs[CreateNewSoftwareBitmap](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCreateNewSoftwareBitmap)]

Because this method accesses the raw buffer underlying the Windows Runtime types, it must be declared using the **unsafe** keyword. You must also configure your project in Microsoft Visual Studio to allow the compilation of unsafe code by opening the project's **Properties** page, clicking the **Build** property page, and selecting the **Allow Unsafe Code** checkbox.

## Create a SoftwareBitmap from a Direct3D surface

To create a **SoftwareBitmap** object from a Direct3D surface, you must include the [**Windows.Graphics.DirectX.Direct3D11**](https://msdn.microsoft.com/library/windows/apps/dn895104) namespace in your project.

[!code-cs[Direct3DNamespace](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetDirect3DNamespace)]

Call [**CreateCopyFromSurfaceAsync**](https://msdn.microsoft.com/library/windows/apps/dn887373) to create a new **SoftwareBitmap** from the surface. As the name indicates, the new **SoftwareBitmap** has a separate copy of the image data. Modifications to the **SoftwareBitmap** will not have any effect on the Direct3D surface.

[!code-cs[CreateSoftwareBitmapFromSurface](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCreateSoftwareBitmapFromSurface)]

## Convert a SoftwareBitmap to a different pixel format

The **SoftwareBitmap** class provides the static method, [**Convert**](https://msdn.microsoft.com/library/windows/apps/dn887362), that allows you to easily create a new **SoftwareBitmap** that uses the pixel format and alpha mode you specify from an existing **SoftwareBitmap**. Note that the newly created bitmap has a separate copy of the image data. Modifications to the new bitmap will not affect the source bitmap.

[!code-cs[Convert](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetConvert)]

## Transcode an image file

You can transcode an image file directly from a [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/br226176) to a [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/br226206). Create a [**IRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241731) from the file to be transcoded. Create a new **BitmapDecoder** from the input stream. Create a new [**InMemoryRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241720) for the encoder to write to and call [**BitmapEncoder.CreateForTranscodingAsync**](https://msdn.microsoft.com/library/windows/apps/br226214), passing in the in-memory stream and the decoder object. Encode options are not supported when transcoding; instead you should use [**CreateAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.createasync). Any properties in the input image file that you do not specifically set on the encoder, will be written to the output file unchanged. Call [**FlushAsync**](https://msdn.microsoft.com/library/windows/apps/br226216) to cause the encoder to encode to the in-memory stream. Finally, seek the file stream and the in-memory stream to the beginning and call [**CopyAsync**](https://msdn.microsoft.com/library/windows/apps/hh701827) to write the in-memory stream out to the file stream.

[!code-cs[TranscodeImageFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetTranscodeImageFile)]

## Related topics

* [BitmapEncoder options reference](bitmapencoder-options-reference.md)
* [Image Metadata](image-metadata.md)
 

 




